


def test_bambu():
    from impl.bambu_client import BambuClient, BambuClientConfig
    import paho.mqtt.client as mqtt
    client = BambuClient(BambuClientConfig("127.0.0.1", 'lan_pwd', "device_serial"))
    msg = """
{"print":{"upgrade_state":{"sequence_id":0,"progress":"100","status":"UPGRADE_SUCCESS","consistency_request":false,"dis_state":3,"err_code":0,"force_upgrade":false,"message":"0%, 0B/s","module":"ota","new_version_state":2,"cur_state_code":0,"new_ver_list":[]},"ipcam":{"ipcam_dev":"1","ipcam_record":"disable","timelapse":"disable","resolution":"1080p","tutk_server":"disable","mode_bits":3},"xcam":{"buildplate_marker_detector":true},"upload":{"status":"idle","progress":0,"message":""},"nozzle_temper":212.03125,"nozzle_target_temper":0,"bed_temper":75.0625,"bed_target_temper":0,"chamber_temper":5,"mc_print_stage":"1","heatbreak_fan_speed":"9","cooling_fan_speed":"0","big_fan1_speed":"0","big_fan2_speed":"0","mc_percent":100,"mc_remaining_time":0,"ams_status":0,"ams_rfid_status":0,"hw_switch_state":1,"spd_mag":100,"spd_lvl":2,"print_error":0,"lifecycle":"product","wifi_signal":"-28dBm","gcode_state":"FINISH","gcode_file_prepare_percent":"100","queue_number":0,"queue_total":0,"queue_est":0,"queue_sts":0,"project_id":"13717146","profile_id":"13775275","task_id":"28660947","subtask_id":"28660948","subtask_name":"小圆片","gcode_file":"","stg":[],"stg_cur":255,"print_type":"idle","home_flag":595084688,"mc_print_line_number":"2820","mc_print_sub_stage":0,"sdcard":true,"force_upgrade":false,"mess_production_state":"active","layer_num":2,"total_layer_num":2,"s_obj":[],"filam_bak":[],"fan_gear":0,"nozzle_diameter":"0.4","nozzle_type":"stainless_steel","cali_version":0,"hms":[],"online":{"ahb":false,"rfid":false,"version":2020871969},"ams":{"ams":[],"ams_exist_bits":"0","tray_exist_bits":"0","tray_is_bbl_bits":"0","tray_tar":"254","tray_now":"254","tray_pre":"254","tray_read_done_bits":"0","tray_reading_bits":"0","version":6,"insert_flag":true,"power_on_flag":false},"vt_tray":{"id":"254","tag_uid":"0000000000000000","tray_id_name":"","tray_info_idx":"GFG99","tray_type":"PETG","tray_sub_brands":"","tray_color":"000000FF","tray_weight":"0","tray_diameter":"0.00","tray_temp":"0","tray_time":"0","bed_temp_type":"0","bed_temp":"0","nozzle_temp_max":"270","nozzle_temp_min":"220","xcam_info":"000000000000000000000000","tray_uuid":"00000000000000000000000000000000","remain":0,"k":0.039999999105930328,"n":1,"cali_idx":-1},"lights_report":[{"node":"chamber_light","mode":"off"}],"command":"push_status","msg":0,"sequence_id":"12122"}}
"""
    client.process_message(msg)